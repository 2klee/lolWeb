<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!--    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"> &lt;!&ndash; 파비콘 &ndash;&gt;-->


    <link rel="stylesheet" th:href="@{/css/dropdowns.css}"/>
    <link rel="stylesheet" th:href="@{/css/main.css}"/>
    <link rel="stylesheet" th:href="@{/css/post.css}"/>
    <link rel="stylesheet" th:href="@{/css/index.css}"/>
    <link rel="stylesheet" th:href="@{/css/lolMain.css}"/>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">

    <title>Carry.kr</title> <!-- 타이틀 -->
</head>
<body>
<!-- 최상단 네비바 -->
<nav class="site-header sticky-top py-1" style="background: #8360CE; ">
    <div class="container d-flex flex-column flex-md-row color-white">
        <a href="/" style="margin-right: 20px">
            <h1 class="yellow-text grape_nuts_font font-weight-bold">carry.kr</h1>
        </a>
        <a class="topNavMenu py-2 d-none d-md-inline-block color-white" href="/lol">
            <span class="btn-two blue mini" id="btnradio1">
                <img src="/img/lol_Icon.png" style="height: 20px"/>
                리그 오브 레전드
            </span>
        </a>
        <a class="topNavMenu py-2 d-none d-md-inline-block color-white" href="/post/list">
            <span class="btn-two blue mini" id="btnradio2">
                <img src="/img/Gersang_Icon.png" style="height: 20px"/>
                거상
            </span>
        </a>
        <a class="topNavMenu py-2 d-none d-md-inline-block color-white" href="#">
            <span class="btn-two blue mini" id="btnradio3">
                <img src="/img/MapleStory_Icon.png" style="height: 20px"/>
                메이플 스토리
            </span>
        </a>
        <a class="topNavMenu py-2 d-none d-md-inline-block color-white" href="#">
            <span class="btn-two blue mini" id="btnradio4">
                <img src="/img/D&F_Icon.png" style="height: 20px"/>던전 앤 파이터
            </span>
        </a>
        <a class="topNavMenu py-2 d-none d-md-inline-block color-white" href="#">
            <span class="btn-two blue mini" id="btnradio5">
                <img src="/img/Loa_Icon.png" style="height: 20px"/>로스트 아크
            </span>
        </a>
    </div>
</nav>
<!--롤 메뉴-->
<nav class="navbar navbar-expand-lg sticky-top navbar-light bg-light" style="padding: 9px 0; font-size: 14px;
font-weight: bolder">
    <div class="container" style="padding: 0 15px;">
        <a class="navbar-brand" href="#">리그 오브 레전드 >> </a>
        <button aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"
                data-target="#navbarNav" data-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="navMenu nav-item">
                    <a class="nav-link" href="#">공지사항</a>
                </li>
                <li class="navMenu nav-item">
                    <a class="nav-link navMenu" href="/simulation">시뮬레이터</a>
                </li>
                <li class="navMenu nav-item">
                    <a class="nav-link navMenu" href="/itemTier">아이템티어</a>
                </li>
                <li class="navMenu nav-item">
                    <a class="nav-link navMenu" href="/probuild">프로빌드</a>
                </li>
                <li class="navMenu nav-item">
                    <a class="nav-link navMenu" href="/post/list">커뮤니티</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<!--롤 메뉴 End-->
<div id="wrap" style="margin: 50px 0">
    <!-- 메인영역 -->
    <main id="postListmain" class="container">
        <div class="row col-12">
            <div class="col">
                <div class="card shadow">
                    <div class="card-header">
                        <div id="loading" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white;">
                                <h2>Loading...</h2>
                            </div>
                        </div>


                        <div style="display: flex; justify-content: space-between;">
                            <ul class="list-group list-group-horizontal d-none d-lg-flex"  style="font-size: 1.3rem">
                                <li class="list-group-item list-group-item-action active" data-toggle="list" role="tab">자유게시판</li>
                                <li class="list-group-item list-group-item-action">시뮬공유</li>
                                <li class="list-group-item list-group-item-action">매드무비</li>
                                <li class="list-group-item list-group-item-action">룰렛게시판</li>
                                <li class="list-group-item list-group-item-action">투표게시판</li>
                            </ul>

                            <div class="dropdown d-lg-none">
                                <button class="btn btn-primary dropdown-toggle" type="button"
                                        id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false" style="font-size: 1.3rem">
                                    전체게시판
                                </button>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="font-size:
                                1.5rem; max-height: 300px; overflow-y: auto;">
                                    <a class="dropdown-item" href="#">시뮬공유</a>
                                    <a class="dropdown-item" href="#">매드무비</a>
                                    <a class="dropdown-item" href="#">룰렛게시판</a>
                                    <a class="dropdown-item" href="#">유머게시판</a>
                                    <a class="dropdown-item" href="#">자유게시판</a>
                                </div>
                            </div>


                            <div style="display: flex; align-items: flex-end;">
                                <span style="margin-right: 5px;">정렬 :</span>
                                <!-- 정렬 목록 -->
                                <div class="dropdown">
                                    <select class="form-control" id="sortOption" style="font-size: 14px;width: 120px;" onchange="sortPostListByItem()">
                                        <option value="id" th:selected="${sort eq 'id'}">글번호</option>
                                        <option value="date" th:selected="${sort eq 'date'}">작성일</option>
                                        <option value="title" th:selected="${sort eq 'title'}">글제목</option>
                                        <option value="replyCount" th:selected="${sort eq 'replyCount'}">댓글수</option>
                                        <option value="nickname" th:selected="${sort eq 'nickname'}">작성자</option>
                                        <option value="viewCount" th:selected="${sort eq 'viewCount'}">조회수</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-body p-5">
                        <!-- table -->
                        <table class="table table-borderless table-hover">
                            <!-- 게시판 헤더 -->
                            <thead>
                            <tr>
                                <th class="col-1">글번호</th>
                                <th class="col-6">글제목</th>
                                <th class="col-2">작성자(IP)</th>
                                <th class="col">작성일</th>
                                <th class="col-2">조회수</th>
                            </tr>
                            </thead>
                            <!-- 게시판 바디 -->
                            <tbody>
                            <tr th:each="post, loop : ${paging}"> <!-- 게시물이 반복되어 리스트로 표시 -->
                                <td style="font-size: 14px; color: #777777">
                                    <p class="mb-0 text-muted" th:text="${paging.getTotalElements - (paging.number * paging.size) - loop.index}"><!--게시물id--></p>
                                </td>
                                <td>
                                    <div class="d-flex">

                                        <a th:href="@{'/post/read/' + ${post.id} + '?page=' + ${paging.number} +'&sort=' + ${sort}}">
                                            <p class="mb-0 text-muted view-post-btn" th:text="${post.title}"
                                               th:data-post-id="${post.id}" style="font-size: 14px;"><!--게시물 제목-->
                                            </p>
                                        </a>


                                        <!-- isImageIncluded가 true인 경우 이미지 아이콘을 표시 -->
                                        <div th:if="${post.isImageIncluded}" >
                                            <img src="/img/img_icon.png" alt="이미지 아이콘" style="width: 12px; margin-bottom: 4px;">
                                        </div>

                                        <div th:if="${post.commentCount > 0}">
                                            <span style="font-size: 12px; margin-bottom: 4px;"
                                                  th:text="'[' + ${post.commentCount} + ']' "></span>
                                        </div>

<!--                                        <p class="commentCountSpan" style="font-size: 12px;margin-bottom: 0px;margin-top: 1px;"></p>-->

                                    </div>
                                </td>
                                <td style="font-size: 14px; color: #777777">
                                    <div class="ds_flex" >
                                        <p class="mb-0 text-muted" th:text="${post.nickname}"></p>
                                        (<p class="mb-0 text-muted"
                                            th:text="${#strings.substring(post.ipAddress, 0, 6)} + '.x.x'"></p>)
                                    </div>
                                </td>
                                <td class="text-muted" style="font-size: 14px; color: #777777">
                                    <p th:if="${post.createtime != null}"
                                       th:text="${#temporals.format(post.createtime, 'yyyy-MM-dd HH:mm:ss')}"><!-- 생성일 표시 --></p>
                                    <p th:unless="${post.createtime != null}"> <!-- 생성일이 null일 때 빈칸 표시 -->
                                        <!-- 빈칸 -->
                                    </p>
                                </td>
                                <td>
                                    <p th:text="${post.views}"></p>

                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <!-- 글쓰기 버튼 -->
                        <div>
                            <a th:href="@{/post/create}">
                                <button type="button" class="btn btn-success" style="width: 100%; font-size:
                                medium">글쓰기</button>
                            </a>
                        </div>

                        <!-- 시뮬 글쓰기 버튼 -->
                        <div>
                            <a th:href="@{/post/simulCreate}">
                                <button type="button" class="btn btn-success" style="width: 100%; font-size:
                                medium">시뮬글쓰기</button>
                            </a>
                        </div>

                        <!-- 무비 글쓰기 버튼 -->
                        <div>
                            <a th:href="@{/post/movieCreate}">
                                <button type="button" class="btn btn-success" style="width: 100%; font-size:
                                medium">무비글쓰기</button>
                            </a>
                        </div>

                        <!-- 룰렛 글쓰기 버튼 -->
                        <div>
                            <a th:href="@{/post/rouletteCreate}">
                                <button type="button" class="btn btn-success" style="width: 100%; font-size:
                                medium">룰렛글쓰기</button>
                            </a>
                        </div>

                        <!-- 투표 글쓰기 버튼 -->
                        <div>
                            <a th:href="@{/post/pollCreate}">
                                <button type="button" class="btn btn-success" style="width: 100%; font-size:
                                medium">투표글쓰기</button>
                            </a>
                        </div>

                        <!-- 페이징 번호 -->
                        <div style="margin-top: 10px">
                            <nav th:if="${!paging.isEmpty()}" aria-label="Page navigation example">
                                <ul class="pagination justify-content-center">
                                    <li th:classappend="${!paging.hasPrevious()} ? 'disabled'" class="page-item">
                                        <a th:href="@{|?page=${paging.number-1}&sort=${sort}|}" class="page-link"
                                           aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    <li th:each="page: ${#numbers.sequence(0, paging.totalPages-1)}"
                                        th:if="${page >= paging.number-5 and page <= paging.number+5}"
                                        th:classappend="${page == paging.number} ? 'active'"
                                        class="page-item">
                                        <a th:text="${page+1}" th:href="@{|?page=${page}&sort=${sort}|}" class="page-link">1</a>
                                    </li>

                                    <li th:classappend="${!paging.hasNext} ? 'disabled'" class="page-item">
                                        <a th:href="@{|?page=${paging.number+1}&sort=${sort}|}" class="page-link" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        <!-- 게시판 검색 -->
                        <div id="search" class="" style="margin-top: 10px;">
                            <form class="form">
                                <div class="form-row justify-content-center">
                                    <!-- 검색 목록 -->
                                    <div class="dropdown">
                                        <select class="form-control" id="searchOption" style="font-size:
                                         14px">
                                            <option value="title">제목</option>
                                            <option value="content">내용</option>
                                            <option value="titleContent">제목+내용</option>
                                            <option value="nickname">작성자</option>
                                        </select>
                                    </div>
                                    <!-- 검색어 입력창 -->
                                    <div class="form-group col-auto">
<!--                                        <input type="text" class="form-control" id="freeSearch" value=""-->
<!--                                               placeholder="Search" style="font-size: 14px">-->
                                        <input type="text" class="form-control" id="freeSearch" value=""
                                               placeholder="Search" style="font-size: 14px" onkeypress="handleKeyPress(event)">
                                    </div>

                                    <div>
<!--                                        <button type="button" style="width: 3rem; height: 3rem" onclick="searchPost()">-->
<!--                                            <iconify-icon icon="pepicons-pencil:enter" width="3rem" height="3rem"-->
<!--                                                          style="color: #545454"></iconify-icon>-->
<!--                                        </button>-->

                                        <button type="button" style="width: 3rem; height: 3rem" onclick="handleButtonClick()">
                                            <iconify-icon icon="pepicons-pencil:enter" width="3rem" height="3rem"
                                                          style="color: #545454"></iconify-icon>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- 메인영역 E -->
</div>
<!-- 푸터영역 -->
<footer class="footer-style" id="footer">
    <div class="f1l1">
        <section class="f1r1b4">
            <div class="copyright">
                copyright &copy; 2023 <a href="https://github.com/su-hak/Avengers" style="color: #fffc57;">Avengers</a>
                All rights reserved.
            </div>
            <div>
            <span>
                이 사이트는 Riot Games의 보증을 받지 않으며 Riot Games 또는 공식적으로 관련된 사람의 견해나 의견을 반영하지 않습니다.
            </span><br>
                <span>
                리그 오브 레전드를 제작하거나 관리하는 데 있어 League of Legends 및 Riot Games는 Riot Games의 상표 또는 등록 상표입니다. Inc. 리그 오브 레전드 © Riot Games, Inc.
            </span>

            </div>
        </section>
    </div>
</footer>
<!-- 푸터영역 E -->


<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
<!--<script src="/js/jquery.sticky.js"></script>-->


<script>
    // 페이지 로딩 시작 시에 로딩 창을 표시합니다.
    document.getElementById('loading').style.display = 'block';

    // 페이지 로딩이 완료된 후에 실행될 함수
    // window.onload = function() {
    //     // 페이지 로딩이 완료되었으므로 로딩 창을 숨깁니다.
    //
    // };

    // 로딩 창을 숨기는 함수
    function hideLoading() {
        console.log("hide");
        document.getElementById('loading').style.display = 'none';
    }
    // showLoading();
    // 페이지 로드 시 실행되는 함수

    // document.addEventListener("DOMContentLoaded", function() {
    //     console.log("1");
    //     // 이곳에 로딩이 완료된 후 실행될 코드를 작성합니다.
    //     showLoading();
    // });

    // function showLoading() {
    //     console.log("로딩시작");
    //     // 모달 창을 표시
    //     $('#loadingModal').modal('show');
    // }
    //
    // function hideLoading() {
    //     console.log("로딩끝");
    //     // 모달 창을 숨김
    //     $('#loadingModal').modal('hide');
    // }
    $(document).ready(function () {

        console.log("show");
        console.log("$(document).ready");
        // 각 게시물의 "보러가기" 버튼 클릭 이벤트 처리
        $(".view-post-btn").click(function () {
            var postId = $(this).data("post-id"); // 해당 버튼에 저장된 게시물 ID 가져오기
            window.location.href = "/post/read/" + postId; // 해당 게시물로 이동
        });


        // 게시물이 로드될때 각 게시글의 총 댓글수 반환

        $("td p.view-post-btn").each(function() {
            var postId = $(this).attr("data-post-id");
            var commentCountSpan = $(this).closest("tr").find(".commentCountSpan");
            //console.log(postId);
            // 게시글의 총 댓글 수를 조회하는 AJAX 요청
            $.ajax({
                type: "GET",
                url: "/comment/" + postId + "/commentCount",
                success: function(response) {
                    // 성공적으로 총 댓글 수를 가져왔을 때 HTML에 표시
                    //      console.log(response);
                    commentCountSpan.text("[" + response + "]");
                }.bind(this), // 함수 내부에서 this를 사용하기 위해 bind를 사용하여 컨텍스트를 유지합니다.
                error: function(error) {
                    console.error("Error:", error);
                }
            });
        });
    });


</script>


<script>
    function handleKeyPress(event) {
        if (event.keyCode === 13) {
            event.preventDefault(); // 엔터 키의 기본 동작 방지 (폼 제출 방지)
            searchPost(); // searchPost() 함수 호출
        }
    }

    // 버튼 클릭 이벤트 처리
    function handleButtonClick() {
        searchPost(); // searchPost() 함수 호출
    }

    function searchPost() {
        var option = $("#searchOption").val();
        var keyword = $("#freeSearch").val();
        // 필요한 데이터를 수집하고 이를 URL에 추가합니다.
        // URLSearchParams 객체를 생성하고 쿼리 매개변수를 추가합니다.
        var params = new URLSearchParams();
        params.append('option', option);
        params.append('keyword', keyword);

        // URLSearchParams 객체를 사용하여 URL에 쿼리 매개변수를 추가합니다.
        var url = "/post/list/search?" + params.toString();
        // 수집한 데이터를 포함하여 해당 URL로 리디렉션합니다.
        window.location.href = url;
    }

    function sortPostListByItem() {
        var selectedValue = $("#sortOption").val();
        var url = "/post/list?sort=" + selectedValue;
        window.location.href = url;
    }

</script>

<script>
    window.onload = function() {

        console.log("window.onload");
        // URL의 쿼리 파라미터에서 페이지 번호를 가져옵니다.
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');
        // 페이지 번호가 없으면 기본값인 0으로 설정합니다.
        const pageNumber = page ? page : 0;
        // 현재 URL에서 페이지 번호를 제거합니다.
        const baseUrl = window.location.href.split('?')[0];
        var selectedValue = $("#sortOption").val();
        // var url = "/post/list?sort=" + selectedValue;
        // 새로운 URL을 생성하여 페이지 번호와 정렬 정보를 추가합니다.
        const newUrl = `${baseUrl}?page=${pageNumber}&sort=${selectedValue}`;
        // 브라우저의 URL을 새로운 URL로 변경합니다.
        history.pushState({}, '', newUrl);
        // hideLoading();
        hideLoading();
    }
</script>

</body>

</html>